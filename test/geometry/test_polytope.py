import numpy as np

from pybdr.geometry import Polytope, Geometry
from pybdr.geometry.operation import cvt2, boundary
from pybdr.util.visualization import vis2dGeo, plot


def test_construction():
    a = np.array(
        [
            [-1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1],
            [1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1],
            [1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0],
            [0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0],
            [0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1],
        ]
    )
    b = np.array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 2, 2, 1, 2, 3])
    p = Polytope(a, b)

    plot([p], [0, 1])
    plot([p], [1, 2])

    # vis2dGeo([p], [0, 1])


def test_vis():
    a = np.array([[-3, 0], [2, 4], [1, -2], [1, 1]])
    b = np.array([-1, 14, 1, 4])
    p = Polytope(a, b)
    boxes = boundary(p, 0.1, Geometry.TYPE.INTERVAL)
    plot([p, *boxes], [0, 1])


def test_construction_from_vertices():
    vs = np.random.rand(100, 2)
    p = cvt2(vs, Geometry.TYPE.POLYTOPE)
    boxes = boundary(p, 0.1, Geometry.TYPE.INTERVAL)
    pts = np.concatenate([box.vertices for box in boxes], axis=0)
    re_p = cvt2(pts, Geometry.TYPE.POLYTOPE)
    vis2dGeo([p, *boxes, pts, re_p], [0, 1])


def test_temp():
    import numpy as np

    from pybdr.geometry import Polytope, Geometry
    from pybdr.geometry.operation import cvt2
    from pybdr.util.visualization import plot

    # initial from linearly ineqalities Ax <= b
    a = np.array(
        [
            [-1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1],
            [1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1],
            [1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0],
            [0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0],
            [0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1],
        ]
    )
    b = np.array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 2, 2, 1, 2, 3])
    p_from_inequalities = Polytope(a, b)

    points = np.random.rand(100, 2)
    p_from_vertices = cvt2(points, Geometry.TYPE.POLYTOPE)

    plot([p_from_inequalities, p_from_vertices], [0, 1])


def test_proj():
    poly = Polytope.rand(2)
    vs = poly.vertices
    proj_poly = poly.proj([0, 1])
    plot([proj_poly, poly, vs], [0, 1])


if __name__ == '__main__':
    pass
